apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

bases:
  - 01-rbac
  - 02-builds
  - 03-tekton
  - 04-config
  - ../../base/stackrox-cicd-token-generator

patches:
- target:
    kind: PipelineRun
    name: stackrox-token-secret-patchme
  patch: |-
    - op: add
      path: /spec/params/-
      value:
        name: "NAMESPACE"
        value: "petclinic-cicd"
    - op: replace
      path: /metadata/name
      value: 'stackrox-token-secret-petclinic-cicd'

patchesJson6902:
  - target:
      group: rbac.authorization.k8s.io
      version: v1
      kind: RoleBinding
      name: cicd-image-puller
    path: cicd-image-puller-rolebinding-patch.yaml
